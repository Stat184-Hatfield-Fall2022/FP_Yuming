---
title: "Stat 184 Final Project"
author: "Yuming Sun"
date: "`r Sys.Date()`"
output: html_document
---



```{r}
rm(list = ls())
dat <- read.table('hospitals.txt')[, c(2, 3, 5, 10, 12, 9)]
names(dat) <- c('Y', 'X1', 'X2', 'X3', 'X4', 'X5')
str(dat)
dat$X5 <- factor(dat$X5)
```

## EDA
```{r fig.height=5.5, fig.width=7.5}
par(mar = c(4, 4, 2, 2))
layout(rbind(1:3, c(4, 5, 5)))
plot(Y ~ X1, dat, xlab = 'age', ylab = 'length of stay')
plot(Y ~ X2, dat, xlab = 'routine culturing ratio', ylab = 'length of stay')
plot(Y ~ X3, dat, xlab = 'average daily census', ylab = 'length of stay')
plot(Y ~ X4, dat, xlab = 'available facilities and serveices', ylab = 'length of stay')
plot(Y ~ X5, dat, xlab = 'region', ylab = 'length of stay')
```

\vspace{.1in}

We can see that all numerical variables are positively correlated with response `length of stay` ($Y$), and response `length of stay` is affected by categorical variable `region` ($X_5$). In addition, we can also notice that there are some outliers in the data.

## Model fitting
First, let's create an additive model using all 5 covariates.
```{r}
fit <- lm(Y ~ ., dat)
summary(fit)
```

## Parameter testing
Based on the above summary output, we see that the variable $X_4$ is not significant. So let's consider a new model without this variable
```{r}
fit_new <- lm(Y ~ . - X4, dat)
summary(fit_new)
```

We see that all variables are significant. Next, let's test whether this new model is significant or not.
```{r}
fit_null <- lm(Y ~ 1, dat)
anova(fit_null, fit_new)
```

The $p$-value is approximately 0.0000, which indicates that this new model is statistically significant.

```{r fig.height=4.5, fig.width=7}
par(mfrow = c(1, 2))
plot(fit_new, which = 1:2)
```

The Residuals vs Fitted plot indicates that the assumptions of linearity and equal variance are roughly reasonable and the Normal Q-Q plot indicates that the normality assumption is roughly reasonable under ignoring these outliers. And we can think that the independence assumption is reasonable based on this study. So, all assumptions are satisfied.

## Conclusion
Based on the previous analysis, we can conclude that the new model with a moderate adjusted R-squared 48.82% and a small residual standard error 1.406 is statistically significant. So, we can say that the new model is useful for predicting `length of stay`. In addition, we can also conclude these 3 numerical variables `age`, `routine culturing ratio` and `average daily census` are significantly positively correlated with `length of stay` and categorical variable `region` is significantly negatively correlated with `length of stay`, that is, the mean of `length of stay` decreases as the level of `region` increases in order of `NE`, `NC`, `S` and `W`.

